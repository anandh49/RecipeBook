<!DOCTYPE html>
<title id="title">Liked</title>
<html lang="en">

<head>
  <style>
/* Base Styles */
body {
  width: 100%;
  min-height: 100vh;
  background-color: #fbfbfb;
  font-family: 'Roboto', sans-serif;
  margin: 0;
  padding: 0;
}

/* Header Styles */
.header {
  background: rgba(255, 255, 255, 0.95);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.sitename {
  font-family: 'Amatic SC', cursive;
  font-weight: 700;
  font-size: 1.8rem;
}

.navmenu ul {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  gap: 20px;
}

.navmenu a {
  text-decoration: none;
  color: #333;
  font-weight: 500;
}

/* Recipe Grid Styles */
.recipe-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 20px;
  width: 90%;
  margin: 30px auto;
  padding: 20px;
}

.block-container {
  position: relative;
  width: 100%;
  aspect-ratio: 1/1;
  transition: all 0.3s ease;
  perspective: 500px;
}

.btn-back {
  position: absolute;
  inset: 0;
  z-index: -1;
  width: 100%;
  height: 100%;
  border-radius: 16px;
  transition: all 0.3s ease;
  transform-style: preserve-3d;
  transform-origin: bottom right;
  transform: rotateZ(15deg);
  will-change: transform;
  box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.1);
  background: linear-gradient(135deg, #4682eb -20%, #01beff 120%);
}

.btn-front {
  position: absolute;
  inset: 0;
  z-index: 1;
  width: 100%;
  height: 100%;
  border-radius: 16px;
  background-color: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
  transform-style: preserve-3d;
  transform-origin: top left;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 15px;
  box-sizing: border-box;
}

.recipe-button {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-decoration: none;
  color: black;
  font-weight: bold;
  width: 100%;
  height: 100%;
}

.recipe-image {
  width: 100%;
  height: 70%;
  object-fit: cover;
  border-radius: 12px;
  margin-bottom: 10px;
}

.recipe-name {
  margin-top: auto;
  font-family: 'Roboto', sans-serif;
  text-align: center;
  font-size: 0.9rem;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 100%;
}

/* Hover Effects */
.block-container:hover {
  transform: translateY(-5px);
}

.block-container:hover .btn-back {
  transform: translateZ(20px) rotateZ(15deg) rotateX(-10deg) rotateY(-10deg);
  box-shadow: 12px 12px 30px rgba(0, 0, 0, 0.15);
}

.block-container:hover .btn-front {
  transform: translateZ(40px) translateY(-5px) rotateX(5deg) rotateY(5deg);
}

/* Filter Styles - RESTORED */
.filter-toggle-btn {
  position: relative;
 top: -310px;
  left: 120px;
  background-color: #4682eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 25px;
  cursor: pointer;
  z-index: 999;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
}

.filter-toggle-btn:hover {
  background-color: #3a6fc8;
  transform: translateY(-2px);
}

.filter-card {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 550px;
  max-width: 90%;
  min-height: 300px;
  background: rgba(255, 255, 255, 0.98);
  box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
  backdrop-filter: blur(18px);
  border-radius: 1rem;
  padding: 1.5rem;
  z-index: 1000;
  display: none;
}

.filter-container {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.filter-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.filter-item label {
  flex: 1;
  text-align: left;
  font-weight: bold;
  color: #333;
}

.slider-container {
  flex: 2;
  display: flex;
  align-items: center;
  gap: 10px;
}

.filter-item input[type="range"] {
  -webkit-appearance: none;
  width: 100%;
  height: 8px;
  border-radius: 4px;
  background: #e0e0e0;
  outline: none;
}

.filter-item input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #4682eb;
  cursor: pointer;
  transition: all 0.2s ease;
}

.filter-item input[type="range"]::-webkit-slider-thumb:hover {
  background: #3a6fc8;
  transform: scale(1.1);
}

.filter-btn {
  background-color: #fa709a;
  color: white;
  padding: 0.8rem 1.8rem;
  border-radius: 2rem;
  cursor: pointer;
  font-size: 1rem;
  margin-top: 20px;
  border: none;
  transition: all 0.3s ease;
  align-self: center;
}

.filter-btn:hover {
  background-color: #e55a84;
  transform: translateY(-2px);
}

.close-filter-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: #666;
  transition: all 0.2s ease;
}

.close-filter-btn:hover {
  color: #333;
  transform: rotate(90deg);
}

/* Overlay */
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 999;
  display: none;
}

/* Pagination */
.pagination {
  text-align: center;
  margin: 30px 0;
}

.pagination button {
  padding: 10px 20px;
  margin: 0 10px;
  border: none;
  background-color: #000000;
  color: white;
  cursor: pointer;
  border-radius: 25px;
  font-size: 14px;
  transition: all 0.3s ease;
}

.pagination button:hover {
  background-color: #333;
}

.pagination button:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}

/* Search Styles */
.search-container {
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.3s ease;
  opacity: 0;
  width: 0;
  overflow: hidden;
}

.search-container.active {
  opacity: 1;
  width: 300px;
}

#searchForm {
  display: flex;
  align-items: center;
  background-color: white;
  border-radius: 25px;
  border: 2px solid #000000;
  overflow: hidden;
  box-shadow: 0px 2px 5px rgba(183, 0, 0, 0.2);
  flex: 1;
}

#searchInput {
  flex: 1;
  padding: 10px 20px;
  border: none;
  outline: none;
  font-size: 16px;
}

#searchForm button {
  background: linear-gradient(to right, #000000, #000000);
  color: white;
  border: none;
  padding: 10px 20px;
  cursor: pointer;
  font-size: 16px;
}

/* Utility Styles */
.no-results {
  text-align: center;
  padding: 40px;
  font-size: 1.2rem;
  color: #666;
  width: 100%;
  grid-column: 1 / -1;
}

.spinner-border {
  display: inline-block;
  width: 1rem;
  height: 1rem;
  vertical-align: text-bottom;
  border: 0.2em solid currentColor;
  border-right-color: transparent;
  border-radius: 50%;
  animation: spinner-border .75s linear infinite;
}

@keyframes spinner-border {
  to { transform: rotate(360deg); }
}

/* Responsive Adjustments */
@media (max-width: 1024px) {
  .recipe-container {
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  }
}

@media (max-width: 768px) {
  .recipe-container {
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 15px;
  }
  
  .navmenu ul {
    gap: 15px;
  }
}

@media (max-width: 480px) {
  .recipe-container {
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 12px;
  }
  
  .recipe-name {
    font-size: 0.8rem;
  }
  
  .filter-card {
    width: 90%;
    padding: 1rem;
  }
  
  .filter-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }
  
  .slider-container {
    width: 100%;
  }
  
  .filter-toggle-btn {
    padding: 8px 16px;
    font-size: 0.9rem;
  }
}
  </style>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="static/assets/img/favicon.png" rel="icon">
  <link href="static/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Amatic+SC:wght@400;700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="static/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="static/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="static/assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="static/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="static/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Font Awesome for search icon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- Main CSS File -->
  <link href="static/assets/css/main.css" rel="stylesheet">
</head>

<body class="index-page">

  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container position-relative d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center me-auto me-xl-0">
        <h1 class="sitename">The Recipe Book</h1>
        <span>.</span>
      </a>
      <nav id="navmenu" class="navmenu">
        <ul>
          <li> <a href="{{ url_for('show_page', page='category') }}">veg/nonveg</a></li>
          <li><a href="{{ url_for('show_page', page='ingredients') }}">Ingredients</a></li>
          <li><a href="{{ url_for('show_page', page='liked') }}">Liked</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>
  
      <!-- Search Container -->
      <div class="search-container" id="searchContainer">
        <div class="search">
          <form id="searchForm">
            <input type="text" id="searchInput" name="search" placeholder="Search recipes..." required>
            <button type="submit">
              <div class="search-icon">
                <i class="fa-solid fa-magnifying-glass" style="color:white;"></i>
              </div>
            </button>
          </form>
        </div>
      </div>
  
      <!-- Search Button -->
      <a class="btn-getstarted" id="searchButton">Search</a>
      <li> <a href="{{ url_for('show_page', page='main') }}" class="active"><img src="{{ url_for('static', filename='images/home.png') }}"></a></li>
    </div>
  </header>

  <main class="main">
    <!-- Hero Section -->
    <section id="hero" class="hero section light-background">
      <div class="container">
        <div class="row gy-4 justify-content-center justify-content-lg-between">
          <div class="col-lg-12 order-2 order-lg-1 d-flex flex-column justify-content-center">
            <h1 data-aos="fade-up">Search By Nutrition</h1>
            <p data-aos="fade-up" data-aos-delay="100">search Recipes Based on nutrition chart</p>
            <div class="recipe-container" id="recipeContainer"></div>
    
            <div class="pagination">
              <button id="prevBtn" onclick="prevPage()" disabled>Prev</button>
              <button id="nextBtn" onclick="nextPage()">Next</button>
            </div>
          </div>
        </div>
      </div>
    </section><!-- /Hero Section -->

    <!-- Liked Recipes Section -->
    <section id="liked-recipes" class="section">
      <div class="container">
        <div class="liked-recipes-container" id="likedRecipesContainer">
          <!-- Liked recipes will be dynamically inserted here -->
        </div>
      </div>
    </section>

  </main>

  <!-- Filter Card (hidden by default) -->
  <div class="overlay" id="filterOverlay"></div>
  <div class="filter-card" id="filterCard">
    <button class="close-filter-btn" id="closeFilterBtn">&times;</button>
    <h2>Filter Recipes</h2>
    <form action="/filter_recipes" method="POST" class="filter-container" id="filterForm">
      <div class="filter-item">
        <label for="calories">Calories:</label>
        <div class="slider-container">
          <input type="range" id="calories" name="calories" min="0" max="1000" step="1" value="0">
          <span id="calories-value">0 kcal</span>
        </div>
      </div>

      <div class="filter-item">
        <label for="protein">Protein:</label>
        <div class="slider-container">
          <input type="range" id="protein" name="protein" min="0" max="500" step="1" value="0">
          <span id="protein-value">0g</span>
        </div>
      </div>

      <div class="filter-item">
        <label for="carbs">Carbs:</label>
        <div class="slider-container">
          <input type="range" id="carbs" name="carbs" min="0" max="500" step="1" value="0">
          <span id="carbs-value">0g</span>
        </div>
      </div>

      <div class="filter-item">
        <label for="fats">Fats:</label>
        <div class="slider-container">
          <input type="range" id="fats" name="fats" min="0" max="300" step="1" value="0">
          <span id="fats-value">0g</span>
        </div>
      </div>

      <div class="filter-item">
        <label for="sugar">Sugar:</label>
        <div class="slider-container">
          <input type="range" id="sugar" name="sugar" min="0" max="200" step="1" value="0">
          <span id="sugar-value">0g</span>
        </div>
      </div>

      <div class="filter-item">
        <label for="fiber">Fiber:</label>
        <div class="slider-container">
          <input type="range" id="fiber" name="fiber" min="0" max="100" step="1" value="0">
          <span id="fiber-value">0g</span>
        </div>
      </div>

      <div class="filter-item">
        <label for="cholesterol">Cholesterol:</label>
        <div class="slider-container">
          <input type="range" id="cholesterol" name="cholesterol" min="0" max="500" step="1" value="0">
          <span id="cholesterol-value">0mg</span>
        </div>
      </div>

      <button class="filter-btn" type="submit">Apply Filters</button>
    </form>
  </div>

  <!-- Filter Toggle Button -->
  <button class="filter-toggle-btn" id="filterToggleBtn">
    <i class="bi bi-funnel-fill"></i> Filter Recipes
  </button>

  <footer id="footer" class="footer dark-background">
    <div class="container">
      <div class="row gy-3">
        <!-- Follow Us Section -->
        <div class="col-lg-3 col-md-6">
          <h4>Follow Us</h4>
          <div class="social-links d-flex">
            <a href="#" class="twitter"><i class="bi bi-twitter-x"></i></a>
            <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
            <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
            <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Copyright Section -->
    <div class="container copyright text-center mt-4">
      <p>Â© <span>Copyright</span> <strong class="px-1 sitename">Recipe Book</strong> <span>All Rights Reserved</span></p>
      <div class="credits">
        Designed using <a href="https://bootstrapmade.com/">BootstrapMade</a></a>
      </div>
    </div>
  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="static/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="static/assets/vendor/php-email-form/validate.js"></script>
  <script src="static/assets/vendor/aos/aos.js"></script>
  <script src="static/assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="static/assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="static/assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Main JS File -->
  <script src="static/assets/js/main.js"></script>

  <script>
    let currentPage = 0;
    const itemsPerPage = 5;

    // Change from const to let to allow updates
    let recipes = [
      {% for recipe in filtered_recipes %}
        {
          name: "{{ recipe.name }}",
          url: "{{ recipe.url }}",
          image: "{{ recipe.image }}",  
          defaultImage: "{{ recipe.default_image }}"
        },
      {% endfor %}
    ];

    let totalPages = Math.ceil(recipes.length / itemsPerPage);
    const recipeContainer = document.getElementById("recipeContainer");

    function showPage(page) {
      recipeContainer.innerHTML = "";
      
      if (recipes.length === 0) {
        recipeContainer.innerHTML = '<div class="no-results">No recipes found matching your filters</div>';
        document.getElementById("prevBtn").disabled = true;
        document.getElementById("nextBtn").disabled = true;
        return;
      }

      const start = page * itemsPerPage;
      const end = start + itemsPerPage;

      recipes.slice(start, end).forEach(recipe => {
        const recipeElement = document.createElement("div");
        recipeElement.className = "block-container";
        recipeElement.innerHTML = `
          <div class="btn-back" style="background: linear-gradient(135deg, #4682eb -20%, #01beff 120%);"></div>
          <div class="btn-front">
            <a href="${recipe.url}" class="recipe-button">
              <img src="${recipe.image}" 
                   onerror="this.onerror=null; this.src='${recipe.defaultImage}';" 
                   class="recipe-image">
              <div class="recipe-name">${recipe.name}</div>
            </a>
          </div>
        `;
        recipeContainer.appendChild(recipeElement);
      });

      document.getElementById("prevBtn").disabled = page === 0;
      document.getElementById("nextBtn").disabled = page >= totalPages - 1;
    }

    function nextPage() {
      if (currentPage < totalPages - 1) {
        currentPage++;
        showPage(currentPage);
      }
    }

    function prevPage() {
      if (currentPage > 0) {
        currentPage--;
        showPage(currentPage);
      }
    }

    // Show the first page on load
    showPage(currentPage);

    // Search functionality
    document.getElementById("searchButton").addEventListener("click", function() {
      const searchContainer = document.getElementById("searchContainer");
      searchContainer.classList.toggle("active");
    });

    document.getElementById("searchForm").addEventListener("submit", async function(event) {
      event.preventDefault();
      let searchQuery = document.getElementById("searchInput").value;
      let response = await fetch('/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ search: searchQuery })
      });
  
      let result = await response.json();
      if (result.redirect) {
        window.location.href = result.redirect;
      } else {
        alert(result.message);
      }
    });

    // Filter functionality
    document.addEventListener("DOMContentLoaded", function() {
      // Update slider values
      const updateValue = (id, unit) => {
        const slider = document.getElementById(id);
        const valueSpan = document.getElementById(id + "-value");
        valueSpan.textContent = slider.value + unit;

        slider.addEventListener("input", function() {
          valueSpan.textContent = this.value + unit;
        });
      };

      updateValue("calories", " kcal");
      updateValue("protein", "g");
      updateValue("carbs", "g");
      updateValue("fats", "g");
      updateValue("sugar", "g");
      updateValue("fiber", "g");
      updateValue("cholesterol", "mg");

      // Filter toggle
      const filterToggleBtn = document.getElementById("filterToggleBtn");
      const filterCard = document.getElementById("filterCard");
      const closeFilterBtn = document.getElementById("closeFilterBtn");
      const filterOverlay = document.getElementById("filterOverlay");

      filterToggleBtn.addEventListener("click", function() {
        filterCard.style.display = "block";
        filterOverlay.style.display = "block";
      });

      closeFilterBtn.addEventListener("click", function() {
        filterCard.style.display = "none";
        filterOverlay.style.display = "none";
      });

      filterOverlay.addEventListener("click", function() {
        filterCard.style.display = "none";
        filterOverlay.style.display = "none";
      });

      // Filter form submission
      document.getElementById("filterForm").addEventListener("submit", async function(event) {
        event.preventDefault();
        
        const submitBtn = event.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Applying...';

        try {
          // Collect filter values
          const filters = {
            calories: document.getElementById("calories").value,
            protein: document.getElementById("protein").value,
            carbs: document.getElementById("carbs").value,
            fats: document.getElementById("fats").value,
            sugar: document.getElementById("sugar").value,
            fiber: document.getElementById("fiber").value,
            cholesterol: document.getElementById("cholesterol").value
          };

          const response = await fetch('/filter_recipes', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(filters)
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const result = await response.json();
          
          if (result.success) {
            // Update recipes and pagination
            recipes = result.filtered_recipes;
            currentPage = 0;
            totalPages = Math.ceil(recipes.length / itemsPerPage);
            showPage(currentPage);
            
            // Close filter dialog
            filterCard.style.display = "none";
            filterOverlay.style.display = "none";
          } else {
            throw new Error(result.error || "Failed to apply filters");
          }
        } catch (error) {
          console.error("Filter error:", error);
          alert(`Error: ${error.message}`);
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
        }
      });
    });
  </script>
</body>
</html>